<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×©×¢×•×Ÿ ×©××™×‘×” ××•×©×œ×</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #f06292;
            --bg-color: #fff5f8; /* ×”× ×” ×”×¦×‘×¢ ×”×•×¨×“×¨×“ ×©×œ ×”×¨×§×¢ */
            --card-bg: #ffffff;
            --text-main: #4a4a4a;
            --text-light: #757575;
            
            /* ×¦×‘×¢×™× ××©×ª× ×™× */
            --current-color: #f06292; 
            --accent-purple: #ab47bc;
            --accent-teal: #26a69a;
            
            --shadow: 0 8px 30px rgba(240, 98, 146, 0.15);
        }

        body {
            font-family: 'Rubik', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background: var(--card-bg);
            width: 100%;
            max-width: 480px;
            padding: 2rem;
            border-radius: 24px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        h1 { color: var(--primary); margin: 0 0 5px 0; font-weight: 700; font-size: 1.8rem; }
        .subtitle { font-size: 0.9rem; color: var(--text-light); margin-bottom: 25px; }

        /* UI Components */
        .mode-selector { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; }
        .mode-option input { display: none; }
        .mode-option label {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100px; height: 80px; background: #f5f5f5; border: 2px solid transparent;
            border-radius: 16px; cursor: pointer; transition: all 0.2s; font-size: 0.9rem; font-weight: 500; color: var(--text-light);
        }
        .mode-option label span { font-size: 1.5rem; margin-bottom: 5px; display: block; }
        .mode-option input:checked + label { background: #fff; border-color: var(--primary); color: var(--primary); box-shadow: 0 4px 15px rgba(240, 98, 146, 0.2); transform: translateY(-2px); }

        .section-title { font-size: 1rem; font-weight: 500; margin-bottom: 15px; color: var(--text-main); }
        .rounds-control {
            display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 25px;
            background: #fafafa; padding: 10px; border-radius: 50px; width: fit-content; margin-left: auto; margin-right: auto;
        }
        .stepper-btn {
            width: 36px; height: 36px; border-radius: 50%; border: none; background: white; color: var(--primary);
            font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center; transition: transform 0.1s;
        }
        .stepper-btn:active { transform: scale(0.9); }
        .stepper-btn.mini { width: 28px; height: 28px; font-size: 1rem; background: #eee; color: #555; }
        .rounds-display { font-size: 1.2rem; font-weight: bold; width: 20px; }

        .inputs-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-bottom: 30px; }
        .time-card {
            background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 10px; width: 90px;
            display: flex; flex-direction: column; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }
        .time-card span { font-size: 0.75rem; color: var(--text-light); margin-bottom: 8px; }
        .time-stepper { display: flex; align-items: center; gap: 8px; }
        .time-value { font-size: 1.2rem; font-weight: 700; color: var(--primary); width: 25px; text-align: center; }

        .alert-setting {
            display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 0.9rem;
            color: var(--text-light); margin-bottom: 25px; background: #f9f9f9; padding: 10px; border-radius: 12px;
        }
        .alert-setting input { border: 1px solid #ddd; border-radius: 6px; padding: 5px; width: 50px; text-align: center; font-family: inherit; }

        /* --- Timer Circle --- */
        .timer-wrapper {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto 30px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .progress-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring__circle-bg {
            stroke: #f0f0f0;
            stroke-width: 8;
            /* ×›××Ÿ ×”×©×™× ×•×™: ×”×¨×§×¢ ×©×œ ×”××¢×’×œ ×”×•× ×¦×‘×¢ ×”×¨×§×¢ ×©×œ ×”×“×£ */
            fill: var(--bg-color); 
        }

        .progress-ring__circle {
            stroke: var(--current-color);
            stroke-width: 8;
            stroke-linecap: round;
            fill: transparent;
            stroke-dasharray: 754; 
            stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s linear, stroke 0.3s ease;
        }

        /* ×”× ×§×•×“×” ×”××¡×ª×•×‘×‘×ª */
        .dot-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(0deg); 
            transition: transform 1s linear;
            pointer-events: none;
        }

        .dot {
            position: absolute;
            top: 8px; 
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background-color: white;
            border: 4px solid var(--current-color);
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: border-color 0.3s ease;
            z-index: 10;
        }

        .timer-content {
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .timer-time {
            font-size: 3.5rem; 
            font-weight: 300;
            color: var(--text-main);
            line-height: 1;
            font-variant-numeric: tabular-nums;
            transition: transform 0.3s, color 0.3s;
        }

        .scale-pulse {
            animation: pulse-digits 1s infinite ease-in-out;
            color: #d32f2f !important;
            font-weight: 500;
        }

        @keyframes pulse-digits {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); } 
            100% { transform: scale(1); }
        }

        .side-badge {
            font-size: 1.1rem;
            font-weight: 700;
            padding: 6px 16px;
            border-radius: 20px;
            margin-bottom: 10px;
            color: white;
            background-color: var(--current-color);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease;
        }

        .mode-side1 { --current-color: var(--primary); }
        .mode-side2 { --current-color: var(--accent-purple); }
        .mode-double { --current-color: var(--accent-teal); }

        /* Buttons */
        .btn-main {
            background-color: var(--current-color);
            color: white; border: none; padding: 16px 40px; font-size: 1.1rem; font-weight: 600;
            border-radius: 50px; cursor: pointer; width: 100%; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.2s; font-family: 'Rubik', sans-serif; margin-bottom: 15px;
        }
        .btn-main:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-main:active { transform: scale(0.98); }

        .btn-pause { background: #ff9800 !important; }

        .btn-reset {
            background: white; color: var(--text-light); border: 2px solid #eee;
            padding: 12px 30px; font-size: 1rem; font-weight: 500; border-radius: 50px;
            cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center;
            gap: 8px; transition: all 0.2s; font-family: 'Rubik', sans-serif;
        }
        .btn-reset:hover { border-color: #ffcdd2; color: #d32f2f; background-color: #ffebee; }

        .status-text { color: var(--current-color); font-weight: 500; margin-bottom: 5px; min-height: 24px; }
        .sub-status { font-size: 0.9rem; color: #999; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-panel">
        <h1>×©×¢×•×Ÿ ×©××™×‘×”</h1>
        <div class="subtitle">×”×’×“×™×¨×™ ××ª ×ª×•×›× ×™×ª ×”×©××™×‘×” ×©×œ×š</div>

        <div class="mode-selector">
            <div class="mode-option">
                <input type="radio" id="single" name="pumpMode" value="single" checked onchange="updateUIForMode()">
                <label for="single"><span>ğŸ¤±</span>×—×“ ×¦×“×“×™</label>
            </div>
            <div class="mode-option">
                <input type="radio" id="double" name="pumpMode" value="double" onchange="updateUIForMode()">
                <label for="double"><span>âš–ï¸</span>×“×• ×¦×“×“×™</label>
            </div>
        </div>
        <div id="mode-helper" style="font-size: 0.8rem; color: #888; margin-bottom: 20px;">
            ××‘×¦×¢ ×¤×¢××™×™× ×›×œ ×–××Ÿ (×™××™×Ÿ/×©×××œ ×œ×¡×™×¨×•×’×™×Ÿ)
        </div>

        <div class="section-title">××¡×¤×¨ ×¡×‘×‘×™×:</div>
        <div class="rounds-control">
            <button class="stepper-btn" onclick="changeRounds(-1)">-</button>
            <span id="roundsCountDisplay" class="rounds-display">3</span>
            <button class="stepper-btn" onclick="changeRounds(1)">+</button>
        </div>

        <div class="section-title">×“×§×•×ª ×œ×›×œ ×¡×‘×‘:</div>
        <div id="dynamicInputs" class="inputs-grid"></div>

        <div class="alert-setting">
            <span>ğŸ”Š ×¦×¤×¦×•×£ ×”×ª×¨×¢×”</span>
            <input type="number" id="preAlertTime" value="30">
            <span>×©× ×™×•×ª ×œ×¤× ×™ ×”×¡×•×£</span>
        </div>

        <button class="btn-main" style="background: var(--primary);" onclick="initTimer()">×”×ª×—×œ×™ ×©××™×‘×”</button>
    </div>

    <!-- Timer Panel -->
    <div id="timer-panel" class="hidden">
        
        <div id="timer-wrapper-div" class="timer-wrapper mode-side1">
            <!-- SVG Circle -->
            <svg class="progress-ring" width="280" height="280">
                <circle class="progress-ring__circle-bg" r="120" cx="140" cy="140"/>
                <circle class="progress-ring__circle" r="120" cx="140" cy="140"/>
            </svg>
            
            <!-- Rotating Dot -->
            <div class="dot-container" id="dot-container">
                <div class="dot"></div>
            </div>

            <!-- Content -->
            <div class="timer-content">
                <div id="side-badge" class="side-badge">×¦×“ ×¨××©×•×Ÿ</div>
                <div id="display" class="timer-time">00:00</div>
            </div>
        </div>

        <div id="msg-box" class="status-text"></div>
        <div id="phase-info" class="sub-status"></div>

        <div style="margin-top: 30px;">
            <button id="action-btn" class="btn-main btn-pause" onclick="toggleTimer()">×”×©×”×”</button>
            <button class="btn-reset" onclick="resetTimer()">
                <span>âœ•</span> ×‘×™×˜×•×œ ×•×—×–×¨×” ×œ×”×’×“×¨×•×ª
            </button>
        </div>
    </div>
</div>

<script>
    let rounds = 3;
    let schedule = [];
    let currentStepIndex = 0;
    let remainingSeconds;
    let totalSecondsCurrentStep;
    let preAlertSeconds;
    let timerInterval;
    let isRunning = false;
    let audioCtx;

    // ×”×’×“×¨×•×ª SVG
    const circle = document.querySelector('.progress-ring__circle');
    const radius = circle.r.baseVal.value;
    const circumference = radius * 2 * Math.PI;

    circle.style.strokeDasharray = `${circumference} ${circumference}`;
    circle.style.strokeDashoffset = circumference;

    function setProgress(percent) {
        // ×§×™×¦×•×¨ ×”×§×•
        const offset = circumference - (percent / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        
        // ×¡×™×‘×•×‘ ×”× ×§×•×“×”
        const degrees = (percent / 100) * 360;
        document.getElementById('dot-container').style.transform = `rotate(${degrees}deg)`;
    }

    window.onload = function() {
        renderTimeInputs();
        updateUIForMode();
    };

    function updateUIForMode() {
        const mode = document.querySelector('input[name="pumpMode"]:checked').value;
        const helper = document.getElementById('mode-helper');
        helper.innerText = mode === 'single' ? 
            "×›×œ ×–××Ÿ ×™×‘×•×¦×¢ ×¤×¢××™×™× (×¤×¢× ×œ×™××™×Ÿ ×•×¤×¢× ×œ×©×××œ ×œ×¡×™×¨×•×’×™×Ÿ)" : 
            "×›×œ ×–××Ÿ ×™×‘×•×¦×¢ ×¤×¢× ××—×ª (×©× ×™ ×”×¦×“×“×™× ×‘×• ×–×× ×™×ª)";
    }

    function changeRounds(delta) {
        rounds += delta;
        if (rounds < 1) rounds = 1;
        if (rounds > 10) rounds = 10;
        document.getElementById('roundsCountDisplay').innerText = rounds;
        renderTimeInputs();
    }

    function renderTimeInputs() {
        const container = document.getElementById('dynamicInputs');
        const existingValues = [];
        document.querySelectorAll('.time-data').forEach(el => existingValues.push(el.innerText));

        container.innerHTML = '';
        const defaultValues = [7, 5, 3, 2, 2];

        for (let i = 0; i < rounds; i++) {
            let val = (i < existingValues.length) ? existingValues[i] : (i < defaultValues.length ? defaultValues[i] : 2);
            
            const div = document.createElement('div');
            div.className = 'time-card';
            div.innerHTML = `
                <span>×¡×‘×‘ ${i + 1}</span>
                <div class="time-stepper">
                    <button class="stepper-btn mini" onclick="updateTime(this, -1)">-</button>
                    <span class="time-value time-data">${val}</span>
                    <button class="stepper-btn mini" onclick="updateTime(this, 1)">+</button>
                </div>
            `;
            container.appendChild(div);
        }
    }

    function updateTime(btn, delta) {
        const display = btn.parentElement.querySelector('.time-value');
        let val = parseInt(display.innerText) + delta;
        if (val < 1) val = 1;
        display.innerText = val;
    }

    // --- Audio Logic ---
    function initAudio() {
        if (!audioCtx) { 
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext(); 
        }
        if (audioCtx.state === 'suspended') { 
            audioCtx.resume(); 
        }
    }

    function playTone(freq, type, duration) {
        initAudio();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
        
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    function playPreAlert() {
        playTone(600, 'sine', 0.15);
        setTimeout(() => playTone(600, 'sine', 0.15), 250);
    }

    function playEndStep() {
        playTone(400, 'triangle', 0.1);
        setTimeout(() => playTone(600, 'triangle', 0.1), 150);
        setTimeout(() => playTone(800, 'triangle', 0.3), 300);
    }

    function initTimer() {
        initAudio();
        
        const mode = document.querySelector('input[name="pumpMode"]:checked').value;
        const timeValues = document.querySelectorAll('.time-data');
        preAlertSeconds = parseInt(document.getElementById('preAlertTime').value);
        
        schedule = [];
        timeValues.forEach(el => {
            const minutes = parseInt(el.innerText);
            if (mode === 'single') {
                schedule.push({ type: 'side1', name: "×¦×“ ×¨××©×•×Ÿ", minutes: minutes });
                schedule.push({ type: 'side2', name: "×¦×“ ×©× ×™", minutes: minutes });
            } else {
                schedule.push({ type: 'double', name: "×“×•-×¦×“×“×™", minutes: minutes });
            }
        });

        if (schedule.length === 0) return;

        currentStepIndex = 0;
        loadStep();
        
        document.getElementById('setup-panel').classList.add('hidden');
        document.getElementById('timer-panel').classList.remove('hidden');
        
        startTimer();
    }

    function loadStep() {
        const step = schedule[currentStepIndex];
        remainingSeconds = step.minutes * 60;
        totalSecondsCurrentStep = remainingSeconds;
        
        document.getElementById('side-badge').innerText = step.name;
        
        const wrapper = document.getElementById('timer-wrapper-div');
        wrapper.className = 'timer-wrapper'; 
        if (step.type === 'side1') wrapper.classList.add('mode-side1');
        else if (step.type === 'side2') wrapper.classList.add('mode-side2');
        else wrapper.classList.add('mode-double');

        updateDisplay();
        
        setProgress(0); 

        document.getElementById('phase-info').innerText = `×©×œ×‘ ${currentStepIndex + 1} ××ª×•×š ${schedule.length}`;
        document.getElementById('msg-box').innerText = "";
        document.getElementById('display').classList.remove('scale-pulse'); 
    }

    function startTimer() {
        initAudio(); 
        isRunning = true;
        const btn = document.getElementById('action-btn');
        btn.innerText = "×”×©×”×”";
        btn.classList.add('btn-pause');
        
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            if (remainingSeconds > 0) {
                remainingSeconds--;
                updateDisplay();
                
                const timePassed = totalSecondsCurrentStep - remainingSeconds;
                const percentPassed = (timePassed / totalSecondsCurrentStep) * 100;
                setProgress(percentPassed);

                if (remainingSeconds === preAlertSeconds) {
                    playPreAlert();
                    document.getElementById('msg-box').innerText = "×ª×™×›×£ ××¡×™×™××™×...";
                    document.getElementById('display').classList.add('scale-pulse');
                }
            } else {
                setProgress(100); 
                handleStepFinish();
            }
        }, 1000);
    }

    function toggleTimer() {
        if (isRunning) {
            isRunning = false;
            clearInterval(timerInterval);
            const btn = document.getElementById('action-btn');
            btn.innerText = "×”××©×š";
            btn.classList.remove('btn-pause');
            document.getElementById('display').classList.remove('scale-pulse');
        } else {
            startTimer();
        }
    }

    function handleStepFinish() {
        isRunning = false;
        clearInterval(timerInterval);
        playEndStep();
        document.getElementById('display').classList.remove('scale-pulse');

        if (currentStepIndex < schedule.length - 1) {
            const nextStep = schedule[currentStepIndex + 1];
            document.getElementById('msg-box').innerText = "×”×¡×‘×‘ ×”×¡×ª×™×™×!";
            
            const btn = document.getElementById('action-btn');
            btn.innerText = `×”×ª×—×œ×™ ${nextStep.name} (${nextStep.minutes} ×“×§')`;
            btn.classList.remove('btn-pause');
            
            currentStepIndex++;
            
            const tempStep = schedule[currentStepIndex];
            remainingSeconds = tempStep.minutes * 60;
            totalSecondsCurrentStep = remainingSeconds;
            
            document.getElementById('display').innerText = 
                `${Math.floor(remainingSeconds / 60).toString().padStart(2,'0')}:${(remainingSeconds%60).toString().padStart(2,'0')}`;
             
            const wrapper = document.getElementById('timer-wrapper-div');
            wrapper.className = 'timer-wrapper';
            if (tempStep.type === 'side1') wrapper.classList.add('mode-side1');
            else if (tempStep.type === 'side2') wrapper.classList.add('mode-side2');
            else wrapper.classList.add('mode-double');
            
            document.getElementById('side-badge').innerText = tempStep.name;
            document.getElementById('phase-info').innerText = `×©×œ×‘ ${currentStepIndex + 1} ××ª×•×š ${schedule.length}`;
            
            setProgress(0);
            
        } else {
            finishAll();
        }
    }

    function finishAll() {
        document.getElementById('msg-box').innerText = "×›×œ ×”×›×‘×•×“! ×¡×™×™××ª ğŸ’–";
        document.getElementById('side-badge').innerText = "×¡×™×•×";
        document.getElementById('side-badge').style.background = "#4caf50";
        document.querySelector('.progress-ring__circle').style.stroke = "#4caf50";
        document.querySelector('.dot').style.borderColor = "#4caf50";
        document.getElementById('action-btn').classList.add('hidden');
        document.getElementById('display').innerText = "00:00";
    }

    function updateDisplay() {
        const m = Math.floor(remainingSeconds / 60);
        const s = remainingSeconds % 60;
        document.getElementById('display').innerText = 
            `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function resetTimer() {
        isRunning = false;
        clearInterval(timerInterval);
        document.getElementById('timer-panel').classList.add('hidden');
        document.getElementById('setup-panel').classList.remove('hidden');
        document.getElementById('action-btn').classList.remove('hidden');
        document.getElementById('side-badge').style.background = "";
        document.getElementById('display').classList.remove('scale-pulse');
    }
</script>

</body>
</html>